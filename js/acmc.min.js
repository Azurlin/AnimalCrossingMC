var item={};$(function(){$.ajax({type:"GET",dataType:'json',url:"data/acmc.data.json",success:function(result){resInit(result)}})});function resInit(result){itemAll=result[0];series=result[1];var htmlstr='';let num=0;for(keyname in series){var tcount="series";tcount=tcount+num;num++;htmlstr+='<li id="'+tcount+'"><a href="#"><i class="icon icon-bookmark"></i>'+keyname+'</a></li>'}$("#treeMenu").html(htmlstr);for(var i=0;i<num;i++){$("#series"+i).on("click",function(){$(".showsearch-tb").html(" ");let na=series[$(this).text()];for(var i=0;i<na.length;i++){$(".showsearch-tb").append(showSearch(na[i]))}})}}function pdcQueue(index,text){var li=$("<li></li>");li.attr("id","numid");li.addClass("list-group-item");var span=$("<span></span>");span.css("float","right");var span2=$("<span></span>").text(text);span2.attr("id","spB"+index);var input=$("<input></input>");input.addClass("numinp");input.attr("value",1);input.attr("type","number");input.attr("id","inp"+index);var div=$("<div></div>");div.addClass("btn-group");var btn1=$("<button></button>");btn1.addClass("btn btn-sm icon icon-caret-up");btn1.attr("type","button");btn1.attr("id","inpbtnA"+index);btn1.on("click",function(){let inbtn="#inp"+getFlag(this.id);let value=Number($(inbtn).val())+1;$(inbtn).val(value)});var btn2=$("<button></button>");btn2.addClass("btn btn-sm icon icon-caret-down");btn2.attr("type","button");btn2.attr("id","inpbtnB"+index);btn2.on("click",function(){let inbtn="#inp"+getFlag(this.id);let value=Number($(inbtn).val());if(value>0)value=value-1;$(inbtn).val(value)});div.append(btn1);div.append(btn2);span.append(input);span.append(div);li.append(span2);li.append(span);$("#pdcdiv").append(li)}$("#searchInputExample").bind('input propertychange',function(){var inp=$("#searchInputExample").val();if(inp!=""){search(inp)}});function search(inputValue){$(".showsearch-tb").html("");for(key in itemAll){if(key.indexOf(inputValue)!=-1){$(".showsearch-tb").append(showSearch(key))}}}function showSearch(itname){var tr=$("<tr></tr>");var tdimg=$("<td></td>");var td1=$("<td></td>").text(itname);var tdbut=$("<td></td>");var btn=$("<button></button>").addClass("btn has-icon-left icon icon-plus");var count=itemAll[itname]["id"];imgurl="https://azurlin.oss-cn-beijing.aliyuncs.com/animal-crossing/img/img"+count+".png";var img=$("<img>");img.attr("src",imgurl);img.attr("width","50px");img.attr("height","50px");tdimg.append(img);td1.attr("id","intd"+count);btn.attr("id","inbt"+count);btn.on("click",function(){let idnum=getFlag(this.id);let text=$("#intd"+idnum).text();if(!isRepeat(item,text)){item[text]=idnum;pdcQueue(idnum,text)}else{let value=$("#inp"+idnum).val();$("#inp"+idnum).val(Number(value)+1)}});tdbut.append(btn);tr.append(tdimg);tr.append(td1);tr.append(tdbut);return tr}$("#rebtn").on("click",function(){window.location.reload()});$("#calbtn").on("click",function(){var objInput=new Array;for(key0 in item){let inpid="#inp"+item[key0];objInput.push($(inpid).val())}var itArr=new Array;var sumArr=new Array;var temp=0;for(itName in item){temp++;for(var key in itemAll[itName]["recipes"]){let number=Number(objInput[temp-1]);if(isInteger(number)&&number>0){var dic=itemAll[itName]["recipes"][key]*number;if(isRepeatArr(itArr,key)){sumArr[itArr.indexOf(key)]+=dic}else{itArr.push(key);sumArr.push(dic)}}}}show(itArr,sumArr)});function show(ite,sum){let paneltext="";$("#showtable").html("");for(let l=0;l<ite.length;l++){paneltext+=ite[l]+":"+sum[l]+"<br>";let tr=$("<tr></tr>");let td1=$("<td></td>").text(ite[l]);td1.addClass("shownametd");let td2=$("<td></td>").text(sum[l]);td2.addClass("shownumtd");tr.append(td1);tr.append(td2);$("#showtable").append(tr.append(td2))}$("#showbtn").on("click",function(){$("#showpanel").html(paneltext)})}function getFlag(str){return str.replace(/[^0-9]/ig,"")}function isRepeat(dict,dictElement){for(key in dict){if(key==dictElement)return true}return false}function isRepeatArr(arr,arrElement){for(var i=0;i<arr.length;i++){if(arr[i]==arrElement)return true}return false}function isInteger(obj){return typeof obj==='number'&&obj%1===0}